<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-translation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">超大规模代码库的 RAG 实践指南 | 诗序</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://NoSugarCoffee.github.io/translation/超大规模代码库的RAG实践指南"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="google-site-verification" content="JuUp00xMkr_DW0Xw_LZpUryS9dZQ0vfdjJCP5lS36qo"><meta data-rh="true" property="og:title" content="超大规模代码库的 RAG 实践指南 | 诗序"><meta data-rh="true" name="description" content="原文作者：Tal Sheffer | 来源：qodo.ai blog"><meta data-rh="true" property="og:description" content="原文作者：Tal Sheffer | 来源：qodo.ai blog"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2026-01-13T12:09:46.000Z"><meta data-rh="true" property="article:tag" content="RAG,代码库,AI"><link data-rh="true" rel="icon" href="/img/blog.svg"><link data-rh="true" rel="canonical" href="https://NoSugarCoffee.github.io/translation/超大规模代码库的RAG实践指南"><link data-rh="true" rel="alternate" href="https://NoSugarCoffee.github.io/translation/超大规模代码库的RAG实践指南" hreflang="en"><link data-rh="true" rel="alternate" href="https://NoSugarCoffee.github.io/translation/超大规模代码库的RAG实践指南" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="诗序 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="诗序 Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/translation/rss.xml" title="诗序 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/translation/atom.xml" title="诗序 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.72e29111.css">
<script src="/assets/js/runtime~main.934213b2.js" defer="defer"></script>
<script src="/assets/js/main.d9ff8993.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/my_logo.gif" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/my_logo.gif" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">技术原创</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/translation">外刊翻译</a></div><div class="navbar__items navbar__items--right"><a href="https://nosugarcoffee.github.io/leetcode/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Leetcode Solutions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/NoSugarCoffee/shixu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/translation/Go 的依赖注入">Go 的依赖注入</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/translation/超大规模代码库的RAG实践指南">超大规模代码库的 RAG 实践指南</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="原文作者：Tal Sheffer | 来源：qodo.ai blog"><header><h1 class="title_f1Hy" itemprop="headline">超大规模代码库的 RAG 实践指南</h1><div class="container_mt6G margin-vert--md"><time datetime="2026-01-13T12:09:46.000Z" itemprop="datePublished">January 13, 2026</time> · <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/25247325" alt="Shixu" itemprop="image"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Shixu</span></div><small class="avatar__subtitle" itemprop="description">Translator</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>原文作者：Tal Sheffer | 来源：<a href="https://www.qodo.ai/blog/rag-for-large-scale-code-repos/" target="_blank" rel="noopener noreferrer">qodo.ai blog</a></p>
<hr>
<p><img loading="lazy" src="https://cdn.gooo.ai/web-images/e62ad820068e6f66737f9fa4445c6e7ae180697fd656cba1af59ca3c1a1349ae" alt="" class="img_ev3q"></p>
<p>最近我们看到了不少很酷的生成式 AI 编程演示，有些甚至会让你觉得，仿佛已经有一个勤奋的 AI Agent 正在疯狂承接 Upwork 上的项目。话虽如此，这些“Upwork 大神”式的 AI，在面对拥有数千个代码仓库、数百万行（大多是遗留）代码的真实企业级代码库时，还是完全不够看的。对于希望采用生成式 AI 的企业开发者来说，上下文感知能力是成功的关键。这正是 Retrieval Augmented Generation (RAG) 技术的用武之地，然而，要将 RAG 落地到大规模代码库中也面临着独特的挑战。</p>
<p>在企业级层面使用 <a href="https://www.qodo.ai/blog/rag-vs-fine-tuning-vs-rag-prompt-engineering/" target="_blank" rel="noopener noreferrer">RAG</a> 的首要障碍之一是 scalability（可扩展性）。RAG 模型必须处理海量数据，并应对跨不同仓库的架构复杂性，这使得实现上下文理解变得困难。在这篇博客中，我将分享 qodo（前身为 Codium）如何通过 RAG 方法，在构建以代码质量和完整性为先的生成式 AI 编程平台的同时，弥合 context windows 有限的 LLM 与庞大复杂代码库之间的差距。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="将-rag-应用于大规模代码仓库">将 RAG 应用于大规模代码仓库<a href="#将-rag-应用于大规模代码仓库" class="hash-link" aria-label="Direct link to 将 RAG 应用于大规模代码仓库" title="Direct link to 将 RAG 应用于大规模代码仓库">​</a></h2>
<p>RAG 大致可以分为两部分：索引知识库（在我们的例子中是代码库）和检索。对于不断变化的生产环境代码库，索引并不是一次性或周期性的工作。我们需要一个强大的 pipeline 来持续维护最新的索引。下图展示了我们的 ingest pipeline：文件被路由到适当的 splitter 进行 chunking，chunk 会被加上自然语言描述进行增强，然后为每个 chunk 生成 vector embeddings，最后存储在 vector DB 中。</p>
<p><img loading="lazy" src="https://cdn.gooo.ai/web-images/3539fdc824ff345f7388e84f6d085eca01bca9667fa26e15490309c7d50ff931" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="chunking">Chunking<a href="#chunking" class="hash-link" aria-label="Direct link to Chunking" title="Direct link to Chunking">​</a></h2>
<p>对于自然语言文本，Chunking 相对简单——段落（和句子）提供了明显的边界点，可以创建语义上有意义的片段。然而，朴素的 chunking 方法很难准确地划分有意义的代码片段，导致边界定义问题以及包含无关或不完整的信息。我们发现，向 LLM 提供无效或不完整的代码片段实际上会损害性能并增加幻觉，而不是提供帮助。</p>
<p>Sweep AI 团队去年发布了<a href="https://github.com/sweepai/sweep/blob/main/docs/pages/blogs/chunking-2m-files.mdx" target="_blank" rel="noopener noreferrer">一篇很棒的博文</a><strong>[译者注：原文链接已失效，此处为修正后的正确链接，指向 Sweep AI 团队在 GitHub 上关于代码分块方案的技术博客。]</strong>，详细介绍了他们的代码 chunking 策略。他们开源了使用 concrete syntax tree (CST) parser 来创建连贯 chunk 的方法，该算法后来被 LlamaIndex 采用。</p>
<p>这是我们的起点，但我们在他们的方法中遇到了一些问题：</p>
<ol>
<li>
<p>尽管有所改进，但 chunk 仍然不总是完整的，有时会丢失关键的 context，如 import 语句或类定义。</p>
</li>
<li>
<p>对可嵌入 chunk 大小的硬性限制并不总是允许捕获较大代码结构的完整 context。</p>
</li>
<li>
<p>该方法没有考虑到企业级代码库的独特挑战。</p>
</li>
</ol>
<p>为了解决这些问题，我们开发了几种策略：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="智能-chunking-策略">智能 Chunking 策略<a href="#智能-chunking-策略" class="hash-link" aria-label="Direct link to 智能 Chunking 策略" title="Direct link to 智能 Chunking 策略">​</a></h3>
<p>Sweep AI 使用 static analysis（静态分析）实现了 chunking，这是对以前方法的巨大改进。但在当前节点超过 token 限制并开始将其子节点拆分为 chunk 而不考虑 context 的情况下，他们的方法并不是最优的。这可能导致在方法或 if 语句中间断开 chunk（例如，‘if’ 在一个 chunk 中，而 ‘else’ 在另一个中）。</p>
<p>为了缓解这个问题，我们使用特定于语言的 static analysis 将节点递归地划分为更小的 chunk，并执行追溯处理以重新添加任何被移除的关键 context。这使我们能够创建尊重代码结构的 chunk，将相关元素保持在一起。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> utilities </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> format_complex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ComplexNumber</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> real</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> real</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">modulus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ComplexNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">multiply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new_real </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new_imag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ComplexNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">new_real</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> new_imag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__str__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> format_complex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Naive chunking:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__str__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> format_complex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>[译者注：Naive chunking 只保留了方法本身，但丢失了其所属的类定义（ComplexNumber）、构造函数（init）以及依赖的 import 语句（format_complex），导致上下文不完整。]</strong></p>
<p><strong>Our chunking:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> utilities </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> format_complex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ComplexNumber</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> real</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> real</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># …</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__str__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> format_complex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">real</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imag</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们的 chunker 将关键 context 与类方法保持在一起，包括任何相关的 import 以及类定义和 init 方法，确保 AI 模型拥有理解和处理此代码所需的所有信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="在-chunk-中维护-context">在 Chunk 中维护 Context<a href="#在-chunk-中维护-context" class="hash-link" aria-label="Direct link to 在 Chunk 中维护 Context" title="Direct link to 在 Chunk 中维护 Context">​</a></h3>
<p>我们发现，embedding 较小的 chunk 通常会带来更好的性能。理想情况下，你希望拥有包含相关 context 的最小可能的 chunk——包含任何无关内容都会稀释 embedding 的语义含义。我们的目标是使 chunk 尽可能小，并将限制设定在 500 个字符左右。大型类或复杂的代码结构通常会超过此限制，导致代码表示不完整或碎片化。</p>
<p>因此，我们开发了一个系统，允许灵活的 chunk 大小，并确保关键 context（如类定义和 import 语句）包含在相关的 chunk 中。</p>
<p>对于一个大型类，我们可能会为单个方法分别创建 embedding 和索引，但在每个方法 chunk 中包含类定义和相关的 import。这样，当检索到特定方法时，AI 模型就拥有了理解和处理该方法所需的完整 context。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="不同文件类型的特殊处理">不同文件类型的特殊处理<a href="#不同文件类型的特殊处理" class="hash-link" aria-label="Direct link to 不同文件类型的特殊处理" title="Direct link to 不同文件类型的特殊处理">​</a></h3>
<p>不同的文件类型（例如代码文件、配置文件、文档）需要不同的 chunking 策略来维护其语义结构。</p>
<p>我们为各种文件类型实施了专门的 chunking 策略，特别关注像 OpenAPI/Swagger 规范这样具有复杂、互连结构的文件。</p>
<p>对于 OpenAPI 文件，我们不是按行或字符进行 chunking，而是按 endpoints 进行 chunking，确保每个 chunk 包含特定 API endpoint 的所有信息，包括其参数、响应和安全定义。</p>
<p><strong>OpenAPI v3.0 – Naive Chunking</strong></p>
<p><img loading="lazy" src="https://cdn.gooo.ai/web-images/3a3fca0719d56303617d5be84c3e8a2d5a0e0de69f213c2aa6b0a268f6f96493" alt="" class="img_ev3q"></p>
<p><strong>OpenAPI v3.0 – Intelligent Chunking</strong></p>
<p><img loading="lazy" src="https://cdn.gooo.ai/web-images/d0a4fe1d2dd710e951aa841997bb3d26cac48a7e9b99512191026af709d5a779" alt="" class="img_ev3q"></p>
<p><img loading="lazy" src="https://cdn.gooo.ai/web-images/c15450d073fb5024bc606b507f7b40ad370fceda9b45371f6929fec3baa2293f" alt="" class="img_ev3q"></p>
<p><img loading="lazy" src="https://cdn.gooo.ai/web-images/cfa16f16dca297f70d49170899296548e4376d0d24c2cabe0d8563cc142bcc04" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用自然语言描述增强-embeddings">使用自然语言描述增强 Embeddings<a href="#使用自然语言描述增强-embeddings" class="hash-link" aria-label="Direct link to 使用自然语言描述增强 Embeddings" title="Direct link to 使用自然语言描述增强 Embeddings">​</a></h2>
<p>代码 embeddings 通常无法捕捉代码的语义含义，特别是对于自然语言查询。</p>
<p>我们使用 LLM 为每个代码 chunk 生成自然语言描述。然后将这些描述与代码一起 embed，从而增强我们针对自然语言查询检索相关代码的能力。</p>
<p>对于前面展示的 <code>map_finish_reason</code> 函数：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># What is this?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Helper utilities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">map_finish_reason</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">  finish_reason</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># openai supports 5 stop sequences - &#x27;stop&#x27;, &#x27;length&#x27;, &#x27;function_call&#x27;, &#x27;content_filter&#x27;, &#x27;null&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># anthropic mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop_sequence&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># cohere mapping - https://docs.cohere.com/reference/generate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;COMPLETE&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MAX_TOKENS&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># cohere + vertex ai</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;length&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ERROR_TOXIC&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content_filter&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ERROR&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># openai currently doesn&#x27;t support an &#x27;error&#x27; finish reason</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># huggingface mapping https://huggingface.github.io/text-generation-inference/#/Text%20Generation%20Inference/generate_stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eos_token&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop_sequence&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FINISH_REASON_UNSPECIFIED&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;STOP&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># vertex ai - got from running `print(dir(response_obj.candidates[0].finish_reason))`: [&#x27;FINISH_REASON_UNSPECIFIED&#x27;, &#x27;MAX_TOKENS&#x27;, &#x27;OTHER&#x27;, &#x27;RECITATION&#x27;, &#x27;SAFETY&#x27;, &#x27;STOP&#x27;,]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SAFETY&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RECITATION&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># vertex ai</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content_filter&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;STOP&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># vertex ai</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;end_turn&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop_sequence&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># anthropic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;max_tokens&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># anthropic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;length&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tool_use&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># anthropic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tool_calls&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> finish_reason </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content_filtered&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content_filter&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> finish_reason</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可能会生成如下描述：</p>
<p>“Python function that standardizes finish reasons from various AI platforms, mapping platform-specific reasons to common terms like ‘stop’, ‘length’, and ‘content_filter’.”<br>
<!-- -->（Python 函数，用于标准化来自各种 AI 平台的完成原因，将特定于平台的原因映射到通用术语，如 ‘stop’、‘length’ 和 ‘content_filter’。）</p>
<p>然后将此描述与代码一起 embed，从而改进对诸如“how to normalize AI completion statuses across different platforms”等查询的检索。这种方法旨在解决当前 embedding 模型中的差距，这些模型不是面向代码的，并且缺乏自然语言和代码之间的有效转换。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="高级检索和排序">高级检索和排序<a href="#高级检索和排序" class="hash-link" aria-label="Direct link to 高级检索和排序" title="Direct link to 高级检索和排序">​</a></h2>
<p>简单的向量相似度搜索通常会检索到不相关或脱离 context 的代码片段，特别是在拥有数百万索引 chunk 的大型多样化代码库中。</p>
<p>我们实施了两阶段检索过程。首先，我们从 vector store 中执行初始检索。然后，我们使用 LLM 根据结果与特定任务或查询的相关性对结果进行过滤和排序。</p>
<p><img loading="lazy" src="https://cdn.gooo.ai/web-images/aa8852cb809e941c7eaafa905bf2ddca8eb771b917cd669269f1884a8e8f8821" alt="" class="img_ev3q"></p>
<p>如果开发者查询“how to handle API rate limiting”，我们的系统可能会首先检索几个与 API 调用和<a href="https://www.qodo.ai/blog/top-software-testing-errors-to-look-out-for/" target="_blank" rel="noopener noreferrer">错误处理</a>相关的代码片段。然后，LLM 会在查询的 context 中分析这些片段，将那些专门处理速率限制逻辑的片段排在前面，并丢弃不相关的结果。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="为企业仓库扩展-rag">为企业仓库扩展 RAG<a href="#为企业仓库扩展-rag" class="hash-link" aria-label="Direct link to 为企业仓库扩展 RAG" title="Direct link to 为  企业仓库扩展 RAG">​</a></h2>
<p>随着仓库数量增长到数千个，如果在每次查询时都跨所有仓库进行搜索，检索会变得嘈杂且效率低下。</p>
<p>我们正在开发 repo 级别的过滤策略，以便在深入研究单个代码 chunk 之前缩小搜索空间。这包括“golden repos”的概念——允许组织指定符合最佳实践并包含组织良好代码的特定仓库。</p>
<p>对于关于特定 microservice（微服务）架构模式的查询，我们的系统可能会首先根据 metadata 和高级内容分析识别出最有可能包含相关信息的 5-10 个仓库。然后，它会在这些仓库中执行详细的代码搜索，从而显著减少噪音并提高相关性。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rag-基准测试和评估">RAG 基准测试和评估<a href="#rag-基准测试和评估" class="hash-link" aria-label="Direct link to RAG 基准测试和评估" title="Direct link to RAG 基准测试和评估">​</a></h2>
<p>由于缺乏标准化的 benchmarks，评估<a href="https://www.qodo.ai/blog/what-is-rag-retrieval-augmented-generation/" target="_blank" rel="noopener noreferrer">代码 RAG 系统</a>的性能具有挑战性。</p>
<p>我们开发了一种多方面的评估方法，结合了自动化指标和来自企业客户的真实使用数据。</p>
<p>我们结合使用相关性评分（开发者实际使用检索到的代码片段的频率）、准确性指标（针对代码补全任务）和效率测量（响应时间、资源使用）。我们还与企业客户密切合作，收集反馈和真实的性能数据。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="结论">结论<a href="#结论" class="hash-link" aria-label="Direct link to 结论" title="Direct link to 结论">​</a></h2>
<p>为海量企业代码库实施 RAG 带来了超出典型 <a href="https://www.qodo.ai/blog/rag-applications-and-examples/" target="_blank" rel="noopener noreferrer">RAG 应用</a>的独特挑战。通过专注于智能 chunking  、增强的 embeddings、高级检索技术和可扩展架构，我们开发了一个能够有效导航和利用企业级代码库中蕴含的巨大知识的系统。</p>
<p>随着我们继续完善我们的方法，我们对 RAG 彻底改变开发者与大型复杂代码库交互方式的潜力感到兴奋。我们相信，这些技术不仅会提高生产力，还会提高大型组织内的代码质量和一致性。</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/translation/tags/rag">RAG</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/translation/tags/代码库">代码库</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/translation/tags/ai">AI</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/translation/Go 的依赖注入"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Go 的依赖注入</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#将-rag-应用于大规模代码仓库" class="table-of-contents__link toc-highlight">将 RAG 应用于大规模代码仓库</a></li><li><a href="#chunking" class="table-of-contents__link toc-highlight">Chunking</a><ul><li><a href="#智能-chunking-策略" class="table-of-contents__link toc-highlight">智能 Chunking 策略</a></li><li><a href="#在-chunk-中维护-context" class="table-of-contents__link toc-highlight">在 Chunk 中维护 Context</a></li><li><a href="#不同文件类型的特殊处理" class="table-of-contents__link toc-highlight">不同文件类型的特殊处理</a></li></ul></li><li><a href="#使用自然语言描述增强-embeddings" class="table-of-contents__link toc-highlight">使用自然语言描述增强 Embeddings</a></li><li><a href="#高级检索和排序" class="table-of-contents__link toc-highlight">高级检索和排序</a></li><li><a href="#为企业仓库扩展-rag" class="table-of-contents__link toc-highlight">为企业仓库扩展 RAG</a></li><li><a href="#rag-基准测试和评估" class="table-of-contents__link toc-highlight">RAG 基准测试和评估</a></li><li><a href="#结论" class="table-of-contents__link toc-highlight">结论</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 诗序 de 小窝, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>