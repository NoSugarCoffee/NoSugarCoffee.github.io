<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="è¯—åº Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="è¯—åº Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/translation/rss.xml" title="è¯—åº Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/translation/atom.xml" title="è¯—åº Blog Atom Feed"><title data-react-helmet="true">One post tagged with &quot;DI&quot; | è¯—åº</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;DI&quot; | è¯—åº"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://NoSugarCoffee.github.io/translation/tags/di"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://NoSugarCoffee.github.io/translation/tags/di"><link data-react-helmet="true" rel="alternate" href="https://NoSugarCoffee.github.io/translation/tags/di" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://NoSugarCoffee.github.io/translation/tags/di" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f8d44672.css">
<link rel="preload" href="/assets/js/runtime~main.dad788fc.js" as="script">
<link rel="preload" href="/assets/js/main.0eac452b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">è¯—åº de å°çª</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/translation">Translation</a></div><div class="navbar__items navbar__items--right"><a href="https://nosugarcoffee.github.io/leetcode/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Leetcode Solutions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/NoSugarCoffee/shixu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/translation/Go çš„ä¾èµ–æ³¨å…¥">Go çš„ä¾èµ–æ³¨å…¥</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;DI&quot;</h1><a href="/translation/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/translation/Go çš„ä¾èµ–æ³¨å…¥">Go çš„ä¾èµ–æ³¨å…¥</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-01-03T14:44:43.813Z" itemprop="datePublished">January 3, 2022</time> Â· 14 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://avatars.githubusercontent.com/u/25247325" alt="Shixu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Shixu</span></a></div><small class="avatar__subtitle" itemprop="description">Translator</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>è¿‡å»å‡ å¹´é‡Œæˆ‘ä¸€ç›´ä½¿ç”¨Javaã€‚æœ€è¿‘ï¼Œç”¨Goå»ºç«‹äº†ä¸€ä¸ªå°é¡¹ç›®ï¼Œç„¶è€Œ Go ç”Ÿæ€ç³»ç»Ÿä¸­ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰åŠŸèƒ½ç¼ºä¹è®©æˆ‘éœ‡æƒŠã€‚äºæ˜¯æˆ‘å†³å®šå°è¯•ä½¿ç”¨ Uber çš„ <a href="https://github.com/uber-go/dig" target="_blank" rel="noopener noreferrer">dig</a> åº“æ¥æ„å»ºæˆ‘çš„é¡¹ç›®ï¼ŒæœŸé—´æ„Ÿè§¦é¢‡æ·±ã€‚</p><p>æˆ‘å‘ç° DI å¸®åŠ©æˆ‘è§£å†³äº†ä¹‹å‰åœ¨ Go åº”ç”¨ç¨‹åºä¸­é‡åˆ°çš„å¾ˆå¤šé—®é¢˜ - è¿‡åº¦ä½¿ç”¨ <code>init</code> å‡½æ•°ï¼Œæ»¥ç”¨å…¨å±€å˜é‡å’Œå¤æ‚çš„åº”ç”¨ç¨‹åºè®¾ç½®ç­‰ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç» DI ï¼Œç„¶ååœ¨ä½¿ç”¨ DI æ¡†æ¶ï¼ˆé€šè¿‡ <code>dig</code> åº“ï¼‰å‰åå†™ä¸€äº›ä¾‹å­åšå¯¹æ¯”ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="di-çš„ç®€è¦æ¦‚è¿°"></a>DI çš„ç®€è¦æ¦‚è¿°<a class="hash-link" href="#di-çš„ç®€è¦æ¦‚è¿°" title="Direct link to heading">#</a></h2><p>ä¾èµ–æ³¨å…¥æ˜¯æŒ‡ä½ çš„ç»„ä»¶ï¼ˆé€šå¸¸åœ¨ go ä¸­æ˜¯ struct ï¼‰åœ¨åˆ›å»ºæ—¶ï¼Œå°±åº”è¯¥è·å–å®ƒä»¬ä¾èµ–å…³ç³»çš„ä¸€ç§æ€æƒ³ã€‚è¿™ä¸é‚£äº›ç»„ä»¶åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå°±å»ºç«‹è‡ªèº«ä¾èµ–å…³ç³»çš„åå…³è”æ¨¡å¼ä¸åŒ ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p><p>å‡è®¾ä½ æ„é€ <code>Server</code> éœ€è¦ <code>Config</code> ç»“æ„ä½“ã€‚ä¸€ç§æ–¹æ³•æ˜¯åœ¨åˆå§‹åŒ–æœŸé—´ <code>Server</code> æ„å»º <code>Config</code> ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Server </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">New</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buildMyConfigSomehow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>çœ‹èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚è°ƒç”¨è€…ç”šè‡³ä¸å¿…çŸ¥é“ <code>Server</code> éœ€è¦è®¿é—® <code>Config</code> ã€‚è¿™äº›éƒ½è¢«æˆ‘ä»¬çš„å‡½æ•°éšè—èµ·æ¥äº†ã€‚</p><p>ç„¶è€Œï¼Œè¿™å­˜åœ¨ä¸€äº›ç¼ºç‚¹ã€‚é¦–å…ˆï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ”¹å˜æˆ‘ä»¬ <code>Config</code>  çš„æ„å»ºæ–¹å¼ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æ”¹å˜æ‰€æœ‰è°ƒç”¨æ„å»ºä»£ç çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬çš„ <code>buildMyConfigSomehow</code> å‡½æ•°ç°åœ¨éœ€è¦ä¸€ä¸ªå‚æ•°ã€‚æ¯ä¸ªè°ƒç”¨å¤„éƒ½éœ€è¦è®¿é—®è¯¥å‚æ•°å¹¶éœ€è¦å°†å…¶ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚</p><p>æ­¤å¤–ï¼Œè¿™ä½¿å¾—å®ç° <code>Config</code> å‡½æ•°å˜å¾—ååˆ†éº»çƒ¦ï¼Œæˆ‘ä»¬å¾—ä»¥æŸç§æ–¹æ³•è¿›å…¥ <code>new</code> å‡½æ•°çš„å†…éƒ¨ï¼Œå¹¶åˆ›å»º<code>Config</code> ã€‚</p><p>è¿™æ˜¯ DI æ–¹å¼ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Server </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">New</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç°åœ¨æˆ‘ä»¬å°† <code>Server</code> ä¸<code>Config</code> åˆ†ç¦»  ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„é€»è¾‘åˆ›é€   <code>Config</code> ç„¶åå°†ç»“æœä¼ é€’ç»™ <code>New</code> å‡½æ•°ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœ <code>Config</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¨¡æ‹Ÿé€”å¾„ ã€‚åªè¦  <code>New</code> å®ç°äº†æˆ‘ä»¬çš„æ¥å£ï¼Œå°±å¯ä»¥ä¼ é€’ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚è¿™ä½¿å¾—æµ‹è¯•å®ç°äº† <code>Config</code> æ¥å£çš„ <code>Server</code>  å¾ˆç®€å•ã€‚</p><p>ä»¤äººç—›è‹¦çš„æ˜¯åœ¨åˆ›å»º <code>server</code> ä¹‹å‰æ‰‹åŠ¨åˆ›å»º <code>config</code> ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªä¾èµ–å…³ç³» â€“  å› ä¸º <code>server</code> ä¾èµ– <code>Config,</code> æ‰€ä»¥éœ€è¦é¦–å…ˆåˆ›å»º <code>Config</code>  ã€‚åœ¨çœŸæ­£çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™äº›ä¾èµ–ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œè¿™ä¼šå¯¼è‡´æ„å»ºåº”ç”¨ç¨‹åºå®Œæˆå…¶å·¥ä½œæ‰€éœ€çš„ç»„ä»¶é—´çš„å¤æ‚é€»è¾‘ ã€‚</p><p>è¿™æ˜¯ DI æ¡†æ¶å¯ä»¥æä¾›å¸®åŠ©çš„åœ°æ–¹ã€‚ DI æ¡†æ¶é€šå¸¸æä¾›ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>â€œæä¾›â€æ–°ç»„ä»¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™å‘Šè¯‰ DI æ¡†æ¶ä¸€æ—¦ä½ æœ‰è¿™äº›ç»„ä»¶ï¼Œè¿˜éœ€è¦å…¶ä»–ä»€ä¹ˆç»„ä»¶ï¼ˆä¾èµ–å…³ç³»ï¼‰ä»¥åŠå¦‚ä½•å»æ„å»ºã€‚</li><li>â€œæ£€ç´¢â€æ„å»ºç»„ä»¶ã€‚</li></ol><p>DI æ¡†æ¶é€šå¸¸åŸºäºæ‚¨å‘Šè¯‰å®ƒçš„â€œ providers â€æ„å»ºä¾èµ–å›¾å¹¶ç¡®å®šå¦‚ä½•æ„å»ºå¯¹è±¡ã€‚è¿™åœ¨æ²¡æœ‰å…·ä½“ä¾‹å­çš„æƒ…å†µä¸‹å¾ˆéš¾ç†è§£ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¸­ç­‰å¤§å°çš„ä¾‹å­ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="ç¤ºä¾‹ç¨‹åº"></a>ç¤ºä¾‹ç¨‹åº<a class="hash-link" href="#ç¤ºä¾‹ç¨‹åº" title="Direct link to heading">#</a></h2><p>æˆ‘ä»¬æ¥çœ‹httpæœåŠ¡å™¨ç«¯çš„ä»£ç  ï¼šå®¢æˆ·ç«¯ä»¥ <code>GET</code> æ–¹å¼è¯·æ±‚ <code>/people</code> è·¯å¾„æ—¶å¹¶è¿”å› JSON ã€‚æˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥å‘ˆç°ä»£ç ï¼Œä¸ºç®€å•èµ·è§ï¼Œå®ƒä»¬éƒ½å­˜åœ¨äºåŒä¸€ä¸ªåŒ…ä¸­ï¼ˆ<code>main</code>ï¼‰ã€‚è¯·å‹¿åœ¨çœŸæ­£çš„ Go ç¨‹åºä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚å¯ä»¥åœ¨<a href="https://gitlab.com/drewolson/go_di_example" target="_blank" rel="noopener noreferrer">æ­¤å¤„</a>æ‰¾åˆ°æ­¤ç¤ºä¾‹çš„å®Œæ•´ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„ <code>Person</code>  ã€‚ä»…æœ‰ä¸€äº›è¢« JSON æ ‡ç­¾æ ‡è®°çš„å±æ€§ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Person </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Id   </span><span class="token builtin">int</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">`json:&quot;id&quot;`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Name </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`json:&quot;name&quot;`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Age  </span><span class="token builtin">int</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">`json:&quot;age&quot;`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>Person</code> æœ‰ <code>Id</code>ï¼Œ<code>Name</code> å’Œ <code>Age</code> ã€‚</p><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹ <code>Config</code> ã€‚ä¸ <code>Person</code> ç±»ä¼¼ï¼Œå®ƒæ²¡æœ‰ä¾èµ–å…³ç³»ã€‚ä¸ <code>Person</code> ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å°†æä¾›æ„é€ å‡½æ•°ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Enabled      </span><span class="token builtin">bool</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  DatabasePath </span><span class="token builtin">string</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Port         </span><span class="token builtin">string</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">      </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    DatabasePath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./example.db&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         </span><span class="token string" style="color:#e3116c">&quot;8000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>Enabled</code> è¡¨ç¤ºç¨‹åºæ˜¯å¦è¿”å›çœŸå®æ•°æ®ã€‚<code>DatabasePath</code> è¡¨ç¤ºæ•°æ®åº“çš„åœ°å€ï¼ˆä½¿ç”¨ sqlite ï¼‰ã€‚<code>Port</code> è¡¨ç¤ºæœåŠ¡å™¨è¿è¡Œçš„ç«¯å£ã€‚</p><p>ä¸‹æ–¹å‡½æ•°ç”¨æ¥æ‰“å¼€æ•°æ®åº“è¿æ¥ã€‚å®ƒä¾èµ–äº <code>Config</code> å¹¶è¿”å› <code>*sql.DB</code> ã€‚</p><p>æ¥ä¸‹æ¥çœ‹çœ‹ <code>PersonRepository</code>ã€‚æ­¤ç»“æ„è´Ÿè´£ä»æ•°æ®åº“ä¸­æå–æ•°æ®å¹¶ååºåˆ—åŒ–ä¸º <code>Person</code> ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> PersonRepository </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  database </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DB</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">repository </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonRepository</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FindAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Person </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> repository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">database</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">`SELECT id, name, age FROM people;`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  people </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Person</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      id   </span><span class="token builtin">int</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      name </span><span class="token builtin">string</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      age  </span><span class="token builtin">int</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Scan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">age</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    people </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">people</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Person</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">   id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Age</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  age</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> people</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewPersonRepository</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">database </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonRepository </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">PersonRepository</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">database</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> database</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>PersonRepository</code>çš„æ„å»ºéœ€è¦æ•°æ®åº“è¿æ¥ã€‚å®ƒæœ‰ä¸€ä¸ªå‡½æ•°<code>FindAll</code>ï¼Œæ­¤å‡½æ•°ä½¿ç”¨æ•°æ®åº“è¿æ¥ä¿¡æ¯å¹¶è¿”å› <code>Person</code> åˆ—è¡¨ã€‚</p><p>è¦åœ¨ HTTP æœåŠ¡å™¨å’Œ <code>PersonRepository</code> ä¹‹é—´æä¾›ä¸€å±‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º <code>PersonService</code> ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> PersonService </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config     </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  repository </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonRepository</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">service </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FindAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Person </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Enabled </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">repository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FindAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Person</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewPersonService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> repository </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonRepository</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonService </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">PersonService</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> repository</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>æˆ‘ä»¬çš„ <code>PersonService</code> ä¾èµ–äº <code>Config</code> å’Œ <code>PersonRepository</code> ã€‚å®ƒæœ‰ä¸€ä¸ªå‡½æ•° <code>FindAll</code> ï¼Œå¦‚æœå¯ç”¨äº†åº”ç”¨ç¨‹åºï¼Œåˆ™ä¼šæœ‰æ¡ä»¶åœ°è°ƒç”¨ <code>PersonRepository</code> ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°äº† <code>Server</code> ã€‚è´Ÿè´£è¿è¡Œ HTTP æœåŠ¡å™¨å¹¶å°†é€‚å½“çš„è¯·æ±‚å§”æ‰˜ç»™ <code>PersonService</code> ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Server </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config        </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  personService </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonService</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Handler </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  mux </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewServeMux</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  mux</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HandleFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/people&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">people</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mux</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  httpServer </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Addr</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  httpServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ListenAndServe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">people</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ResponseWriter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  people </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">personService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FindAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Marshal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">people</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Content-Type&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WriteHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> service </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">PersonService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">        config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    personService</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>Server</code> å–å†³äº <code>PersonService</code> å’Œ <code>Config</code> ã€‚</p><p>å¥½çš„ï¼Œæˆ‘ä»¬äº†è§£äº†ç³»ç»Ÿçš„æ‰€æœ‰ç»„ä»¶ã€‚ç°åœ¨æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨å®é™…ä¸­åˆå§‹åŒ–å®ƒä»¬å¹¶å¯åŠ¨æˆ‘ä»¬çš„ç³»ç»Ÿï¼Ÿ</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="ä¼ ç»Ÿçš„-main"></a>ä¼ ç»Ÿçš„ mainï¼ˆï¼‰<a class="hash-link" href="#ä¼ ç»Ÿçš„-main" title="Direct link to heading">#</a></h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç”¨ä¼ ç»Ÿæ–¹å¼ç¼–å†™ <code>main()</code> ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  config </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ConnectDatabase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  personRepository </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewPersonRepository</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  personService </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewPersonService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> personRepository</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  server </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> personService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»º <code>Config</code> ã€‚ç„¶åä½¿ç”¨ <code>Config</code> åˆ›å»ºæ•°æ®åº“è¿æ¥ã€‚ä»è€Œåˆ›å»º <code>PersonRepository</code> å’Œ<code>PersonService</code> ã€‚æœ€åï¼Œå†åˆ›å»º <code>Server</code> å¹¶è¿è¡Œå®ƒã€‚</p><p>è¿™æœ‰äº›å¤æ‚ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œéšç€æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„å˜å¾—å¤æ‚ï¼Œ <code>main</code> çš„å¤æ‚æ€§ä¹Ÿå°†ç»§ç»­å¢é•¿ã€‚æ¯æ¬¡æˆ‘ä»¬å‘ä»»ä½•ç»„ä»¶æ·»åŠ æ–°çš„ä¾èµ–æ—¶ï¼Œéƒ½å¿…é¡»é€šè¿‡ <code>main</code> å‡½æ•°ä¸­çš„æ’åºå’Œé€»è¾‘æ¥åæ˜ è¯¥ä¾èµ–ï¼Œä»¥æ„å»ºè¯¥ç»„ä»¶ã€‚</p><p>æ‚¨å¯èƒ½å·²ç»çŒœåˆ°ï¼Œä¾èµ–æ³¨å…¥æ¡†æ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸€èµ·æ¥çœ‹çœ‹ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="åˆ›å»ºå®¹å™¨"></a>åˆ›å»ºå®¹å™¨<a class="hash-link" href="#åˆ›å»ºå®¹å™¨" title="Direct link to heading">#</a></h2><p>æœ¯è¯­â€œ å®¹å™¨ï¼ˆcontainerï¼‰ â€é€šå¸¸ç”¨åœ¨ DI æ¡†æ¶ä¸­ï¼Œç”¨äºæè¿°æ·»åŠ â€œ æä¾›è€…ï¼ˆprovidersï¼‰ â€çš„å†…å®¹ï¼Œå¹¶ä»ä¸­è¯·æ±‚æ„å»ºå¯¹è±¡ã€‚ <code>dig</code> åº“ç”¨ <code>Provide</code> å‡½æ•°ä¸ºæˆ‘ä»¬æ·»åŠ â€œ providers â€ï¼Œ <code>Invoke</code> å‡½æ•°ç”¨äºä»å®¹å™¨ä¸­æ£€ç´¢å…¨éƒ¨çš„æ„å»ºå¯¹è±¡ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ªæ–°å®¹å™¨ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">container </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> dig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">New</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ·»åŠ æ–°çš„æä¾›è€…ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨å®¹å™¨ä¸Šè°ƒç”¨ <code>Provide</code> å‡½æ•°ã€‚å®ƒåªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼šä¸€ä¸ªå‡½æ•°ã€‚æ­¤å‡½æ•°å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„å‚æ•°ï¼ˆè¡¨ç¤ºè¦åˆ›å»ºçš„ç»„ä»¶çš„ä¾èµ–å…³ç³»ï¼‰å’Œä¸€ä¸ªæˆ–ä¸¤ä¸ªè¿”å›å€¼ï¼ˆè¡¨ç¤ºå‡½æ•°æä¾›çš„ç»„ä»¶ä»¥åŠå¯é€‰çš„é”™è¯¯ï¼‰ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¸Šé¢çš„ä»£ç è¯´â€œæˆ‘ä¸ºå®¹å™¨æä¾›äº†ä¸€ç§ <code>Config</code> ç±»å‹ã€‚ä¸ºäº†æ„å»ºå®ƒï¼Œæˆ‘ä¸éœ€è¦ä»»ä½•å…¶ä»–ä¸œè¥¿ã€‚â€œç°åœ¨æˆ‘ä»¬å·²ç»å‘å®¹å™¨å±•ç¤ºäº†å¦‚ä½•æ„å»º <code>Config</code> ç±»å‹ï¼Œç»§ç»­ä½¿ç”¨å®ƒæ¥æ„å»ºå…¶ä»–ç±»å‹ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DB</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ConnectDatabase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¿™æ®µä»£ç è¯´â€œæˆ‘ä¸ºå®¹å™¨æä¾›äº†ä¸€ç§ <code>*sql.DB</code> ç±»å‹ã€‚ä¸ºäº†æ„å»ºå®ƒï¼Œæˆ‘éœ€è¦ä¸€ä¸ª <code>Config</code> ã€‚å¯ä»¥é€‰æ‹©è¿”å›é”™è¯¯ã€‚â€œ</p><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡å¿…è¦è¿™æ ·å†™ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»æœ‰äº† <code>NewConfig</code> å’Œ <code>ConnectDatabase</code> å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä»–ä»¬ä½œä¸ºå®¹å™¨çš„æä¾›è€…ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NewConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ConnectDatabase</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¹‹å‰ç»™å®¹å™¨æä¾›çš„ç±»å‹ä¸­åˆ›å»ºç»„ä»¶ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>Invoke</code> å‡½æ•°ï¼Œå‡½æ•°é‡‡ç”¨å•ä¸ªå‚æ•° - å…·æœ‰ä»»æ„æ•°é‡å‚æ•°çš„å‡½æ•°ã€‚å‡½æ•°çš„å‚æ•°æ˜¯æˆ‘ä»¬å¸Œæœ›å®¹å™¨æ„å»ºçš„ç±»å‹ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">container.Invoke(func(database *sql.DB) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  // sql.DB is ready to use here</span></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å®¹å™¨åšäº†ä¸€äº›éå¸¸èªæ˜çš„ä¸œè¥¿ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>å®¹å™¨è®¤è¯†åˆ°æˆ‘ä»¬è¦æ±‚çš„æ˜¯æ„å»º <code>*sql.DB</code></li><li>å®ƒç¡®å®šå‡½æ•° <code>ConnectDatabase</code> æä¾›è¯¥ç±»å‹</li><li>æ¥ä¸‹æ¥å®ƒç¡®å®š <code>ConnectDatabase</code> å‡½æ•°ä¾èµ– <code>Config</code></li><li>å®ƒæ‰¾åˆ°äº† <code>Config</code> çš„æä¾›è€…ï¼Œä¹Ÿå°±æ˜¯ <code>NewConfig</code></li><li><code>NewConfig</code> æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å®ƒè¢«è°ƒç”¨</li><li><code>NewConfig</code> çš„ç»“æœæ˜¯ä¸€ä¸ª <code>Config</code> ä¼ é€’ç»™ <code>ConnectDatabase</code></li><li><code>ConnectionDatabase</code> çš„ç»“æœæ˜¯ <code>*sql.DB</code> è¢«ä¼ é€’ç»™ <code>Invoke</code></li></ul><p>è¿™æ˜¯å®¹å™¨ä¸ºæˆ‘ä»¬åšçš„å¾ˆå¤šå·¥ä½œã€‚äº‹å®ä¸Šï¼Œå®ƒåšçš„æ›´å¤šã€‚å®¹å™¨å¾ˆæ™ºèƒ½ï¼Œå¯ä»¥æ„å»ºæ¯ç§ç±»å‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬åœ¨å¤šä¸ªåœ°æ–¹ï¼ˆæ¯”å¦‚å¤šä¸ªå­˜å‚¨åº“ï¼‰ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬æ°¸è¿œä¸ä¼šæ„å¤–åœ°åˆ›å»ºç¬¬äºŒä¸ªæ•°æ®åº“è¿æ¥ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="è¾ƒå¥½çš„-mainå†™æ³•"></a>è¾ƒå¥½çš„ mainï¼ˆï¼‰å†™æ³•<a class="hash-link" href="#è¾ƒå¥½çš„-mainå†™æ³•" title="Direct link to heading">#</a></h2><p>ç°åœ¨çŸ¥é“äº† <code>dig</code> å®¹å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè®©æˆ‘ä»¬ç”¨å®ƒæ¥æ„å»ºä¸€ä¸ªè¾ƒå¥½çš„main ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">BuildContainer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">dig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Container </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> dig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">New</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NewConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ConnectDatabase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NewPersonRepository</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NewPersonService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Provide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NewServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> container</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">container </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">BuildContainer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¹‹å‰å”¯ä¸€æ²¡è§è¿‡çš„å°±æ˜¯ <code>Invoke</code> çš„è¿”å›å€¼ <code>error</code> ã€‚å¦‚æœä»»ä½•æä¾›è€…ä½¿ç”¨ <code>Invoke</code> è¿”å›é”™è¯¯ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>Invoke</code> å°†åœæ­¢å¹¶è¿”å›è¯¥é”™è¯¯ã€‚</p><p>è™½ç„¶è¿™ä¸ªä¾‹å­å¾ˆå°ï¼Œä½†åº”è¯¥å¾ˆå®¹æ˜“çœ‹å‡ºè¿™ç§æ–¹æ³•çš„ä¸€äº›å¥½å¤„è¶…è¿‡äº†â€œå¸¸è§„â€œçš„ main ã€‚éšç€åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œè¿™äº›å¥½å¤„å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚</p><p>æœ€é‡è¦çš„å¥½å¤„ä¹‹ä¸€æ˜¯å°†ç»„ä»¶çš„åˆ›å»ºä¸å…¶ä¾èµ–çš„åˆ›å»ºåˆ†ç¦»ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬  <code>PersonRepository</code> ç°åœ¨éœ€è¦è®¿é—® <code>Config</code> ã€‚æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯æ›´æ”¹ <code>NewPersonRepository</code> æ„é€ å‡½æ•°ä»¥åŒ…å« <code>Config</code> ä½œä¸ºå‚æ•°ã€‚ä»£ç å…¶ä»–ä»»ä½•å†…å®¹æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p><p>å…¶ä»–çš„å¥½å¤„æ˜¯æ²¡æœ‰å…¨å±€çŠ¶æ€ï¼Œæ²¡æœ‰è°ƒç”¨ <code>init</code> ï¼ˆä¾èµ–å…³ç³»åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºï¼Œåªåˆ›å»ºä¸€æ¬¡ï¼Œä¸éœ€è¦å®¹æ˜“å‡ºé”™çš„ <code>init</code> è®¾ç½®ï¼‰ï¼Œå¹¶ä¸”æ˜“äºæµ‹è¯•å•ä¸ªç»„ä»¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨æµ‹è¯•ä¸­åˆ›å»ºå®¹å™¨å¹¶è¦æ±‚å®Œæ•´æ„å»ºå¯¹è±¡è¿›è¡Œæµ‹è¯•ã€‚æˆ–è€…ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡éœ€è¦æ‰€æœ‰çš„ä¾èµ–ã€‚ä½¿ç”¨ DI ï¼Œè¿™äº›éƒ½æ›´å®¹æ˜“ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="ä¸€ä¸ªå€¼å¾—ä¼ æ’­çš„æƒ³æ³•"></a>ä¸€ä¸ªå€¼å¾—ä¼ æ’­çš„æƒ³æ³•<a class="hash-link" href="#ä¸€ä¸ªå€¼å¾—ä¼ æ’­çš„æƒ³æ³•" title="Direct link to heading">#</a></h2><p>æˆ‘ç›¸ä¿¡ä¾èµ–æ³¨å…¥æœ‰åŠ©äºæ„å»ºæ›´å¼ºå¤§å’Œå¯æµ‹è¯•çš„åº”ç”¨ç¨‹åºã€‚éšç€è¿™äº›åº”ç”¨ç¨‹åºä½“é‡é€æ¸å¢å¤§ï¼Œå°¤ä¸ºæ˜æ˜¾ã€‚ Go éå¸¸é€‚åˆæ„å»ºå¤§å‹åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å…·æœ‰å¾ˆå¥½çš„ DI å·¥å…· <code>dig</code> ã€‚æˆ‘ç›¸ä¿¡ Go ç¤¾åŒºåº”è¯¥æ¥å— DI å¹¶åœ¨æ›´å¤šçš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒã€‚</p><blockquote><p>åŸæ–‡ï¼š<a href="https://blog.drewolson.org/dependency-injection-in-go" target="_blank" rel="noopener noreferrer">dependency-injection-in-go</a></p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/translation/tags/go">go</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/translation/tags/di">DI</a></li></ul></div><div class="col col--3 text--right"><a aria-label="Read more about Go çš„ä¾èµ–æ³¨å…¥" href="/translation/Go çš„ä¾èµ–æ³¨å…¥"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 è¯—åº de å°çª, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.dad788fc.js"></script>
<script src="/assets/js/main.0eac452b.js"></script>
</body>
</html>